{"version":3,"sources":["uni-app:///main.js","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?f79b","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?ca74","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?94eb","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?acbf","uni-app:///packageA/tuijianyouli/canvas.vue","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?040a","webpack:///F:/test-uniapp2/万象优鲜商城生鲜配送系统生鲜批发版本APP小程序公众号抖音小程序快手商城小程序/packageA/tuijianyouli/canvas.vue?9c9b"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","openSetting","data","isShowOpenSetting","isShowLoading","avatarSrc","avatarSize","codeSize","codeX","codeY","canvasBgWidth","canvasBgHeight","gbImgSrc","temPathArr","avatar","code","bg","avatarCode","shareImgPath","mounted","onShow","that","onLoad","console","methods","pc2pxFn","px","setConfigFn","msg","shareCodeImgHttpSrc","Promise","then","catch","clipArcAvatarFn","ctx","imgW","imgH","imgPath","saveAvatarFn","uni","canvasId","success","fail","createSharImgFn","bgImgSrc","avatarX","avatarY","getAvatarInfo","avatarMargin","getShareCodeImgFn","url","result","resFn","type","rejFn","failFn","showCancel","title","saveShearImgFn","e","saveImgAppFn","src","filePath","icon","saveImgFn","settingInfo","cloneSettingFn","showShareImgFn","computed","userInfoAvatar"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACsC;;;AAG3F;AAC+L;AAC/L,gBAAgB,wMAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAkuB,CAAgB,uvBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;ACwCtvB;AAKA;AACA;AAAA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eAEA;EACAC;IAAAC;EAAA;EACAC;IACA;MACAC;MACAC;MACA;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;MAEA;MACAC;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;MACA;;MACAC;IACA;EACA;EACAC;IACA;EAaA;EACAC;IACA;IACAC;EAeA;EACAC;IACAC;EACA;EACAC;IACA;IACAC;MACAC;MACA;MACA;IACA;IAEA;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAN;gBACAA;gBACAA;gBAAA,IAEAA;kBAAA;kBAAA;gBAAA;gBACAA;kBACAO;gBACA;gBAAA;cAAA;gBAIAP;gBACAA;gBACAA;;gBAEAA;gBACAA;;gBAEAA;;gBAEA;gBAAA;gBAAA,OACAA;cAAA;gBAAAQ;gBAEA;kBACAC,aACA,qDACA,yCACA,uCACA,EACAC;oBACA;oBACAV;oBACAA;oBACAA;oBAEAE;oBAEAF;kBACA,GACAW;oBACAX;sBACAO;oBACA;kBACA;gBACA;kBACAP;oBACAO;kBACA;gBACA;gBAEAL;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAU;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAZ,eACA;gBACAa,+CAEA;gBACAC,wBACAC,wBACAC;gBAEAH;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;gBACAA;kBACA;kBACAb;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACA;IACAiB;MACA;MACA;MACAC,yBACA;QACAC;QACAC;UACA;UAEApB;UAEAE;UACAF;QACA;QACAqB;UACArB;YACAO;UACA;QACA;MACA,GACAP,KACA;IACA;IACA;IACAsB;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACAtB;gBACAuB,+BAEA;gBACAV,gDACA;gBAEA;gBACAC,2BACAC,4BACAC,oBAEA;gBACAH;gBACA;kBACA;kBACA;oBACAE;oBACAC;kBAEAH;kBAEAA;kBAEA;oBAAA5B;oBAAAuC;oBAAAC;kBAEAZ;kBACAA;kBACAA;kBAEAA,cACAb,4BACAwB,0BACAC,0BACAxC,YACAA,WACA;kBAEA4B;oBACAb;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACA0B;MACA;MACA;QAAA;QACAC;QAAA;QACAH;QAAA;QACAC;MACA;QACAxC;QACAuC;QACAC;MACA;IACA;IAEA;IACAG;MACA;MACA;QAAA;UAAA;UAAA;YAAA;cAAA;gBAAA;kBAAA;kBAAA,OACA5B;oBACA6B;kBACA;gBAAA;kBAFAC;kBAGA;oBACA;sBACAC;wBACAC;wBACAzB;wBACAuB;sBACA;oBACA;sBACAG;wBACAD;wBACAzB;wBACAuB;sBACA;oBACA;kBACA;oBACAG;sBACAD;sBACAzB;sBACAuB;oBACA;kBACA;gBAAA;gBAAA;kBAAA;cAAA;YAAA;UAAA;QAAA,CACA;QAAA;UAAA;QAAA;MAAA;IACA;IAEAI;MACA;MACAhB;QACAiB;QAAA;QACAC;QACAhB;UACA;UACAlB;UACAF;QACA;MACA;IACA;IACA;IACAqC;MACA;MACA;MACA;QACAnB;UACAkB;UACAhB;YACAkB;cAAAT;YAAA;UACA;QACA;QACA;MACA;IAQA;IACA;IACAU;MAEArB;QACAsB;QACApB;UACAF;YACAuB;YACArB;cACAF;gBACAwB;gBACAN;cACA;YACA;YACAf;cACAH;gBACAwB;gBACAN;cACA;YACA;UACA;QACA;QACAf;UACAnB;QACA;MACA;IACA;IACA;IACAyC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA3C,eACA;gBAAA;gBAAA,OACAA;cAAA;gBAAA4C;gBACA1C;gBAEA;kBACA;kBACA;oBACA;oBACA;;oBAEAF;oBACA;;;AAGA;AACA;AACA;AACA;kBAGA;kBACA;kBACA;oBACAkB;sBACAsB;sBACApB;wBACAF;0BACAuB;0BACArB;4BACAF;8BACAwB;8BACAN;4BACA;0BACA;0BACAf;4BACAH;8BACAwB;8BACAN;4BACA;0BACA;wBACA;sBACA;sBACAf;wBACAnB;sBACA;oBACA;kBACA;gBACA;kBACAgB;oBACAwB;oBACAN;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IACAS;MACA3C;MACA;IACA;IACA;IACA4C;MACA;MACA;MACA5B,yBACA;QACAC;QACAC;UACA;UACApB;UACAA;QACA;QACAqB;UACArB;YACAO;UACA;QACA;MACA,GACAP,KACA;IACA;EACA;EACA+C,4BACA;IACAC;MAAA;IAAA;EACA;AAGA;AAAA,2B;;;;;;;;;;;;;ACjdA;AAAA;AAAA;AAAA;AAA64C,CAAgB,02CAAG,EAAC,C;;;;;;;;;;;ACAj6C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"packageA/tuijianyouli/canvas.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './packageA/tuijianyouli/canvas.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./canvas.vue?vue&type=template&id=ec52d74e&scoped=true&\"\nvar renderjs\nimport script from \"./canvas.vue?vue&type=script&lang=js&\"\nexport * from \"./canvas.vue?vue&type=script&lang=js&\"\nimport style0 from \"./canvas.vue?vue&type=style&index=0&id=ec52d74e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ec52d74e\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"packageA/tuijianyouli/canvas.vue\"\nexport default component.exports","export * from \"-!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./canvas.vue?vue&type=template&id=ec52d74e&scoped=true&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./canvas.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./canvas.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"page\">\r\n\t\t<open-setting\r\n\t\t\t:is-show=\"isShowOpenSetting\"\r\n\t\t\t@cloneFn=\"cloneSettingFn\"\r\n\t\t\ttitle=\"打开允许保存到相册设置\"\r\n\t\t></open-setting>\r\n\t\t<view class=\"hide-canvas-dom\">\r\n\t\t\t<canvas\r\n\t\t\t\tclass=\"avatarCanvas\"\r\n\t\t\t\t:style=\"{ width: avatarSize + 'px', height: avatarSize + 'px' }\"\r\n\t\t\t\tcanvas-id=\"avatarCanvas\"\r\n\t\t\t/>\r\n\t\t\t<canvas\r\n\t\t\t\tclass=\"sharImgCanvas\"\r\n\t\t\t\t:style=\"{ width: canvasBgWidth + 'px', height: canvasBgHeight + 'px' }\"\r\n\t\t\t\tcanvas-id=\"sharImgCanvas\"\r\n\t\t\t/>\r\n\t\t</view>\r\n\t\t<loading-css :is-show=\"isShowLoading\" />\r\n\t\t<image\r\n\t\t\tv-if=\"shareImgPath\"\r\n\t\t\t:src=\"shareImgPath\"\r\n\t\t\t:style=\"{ display: 'block', width: canvasBgWidth + 'px', height: canvasBgHeight + 'px' }\"\r\n\t\t></image>\r\n\t\t<!-- #ifdef MP-WEIXIN || APP-PLUS -->\r\n\t\t<view class=\"bottom-btn-block\">\r\n\t\t\t<button\r\n\t\t\t\tclass=\"pay-btn\"\r\n\t\t\t\t:class=\"[isAllAngle ? 'border-radius-style-all-arg' : 'border-radius-style-half-arg']\"\r\n\t\t\t\t@click=\"saveShearImgFn\"\r\n\t\t\t\t:style=\"{ background: configInfo.web_site_color }\"\r\n\t\t\t>\r\n\t\t\t\t保存图片\r\n\t\t\t</button>\r\n\t\t</view>\r\n\t\t<!-- #endif -->\r\n\t</view>\r\n</template>\r\n<script>\r\nimport {\r\n    mapState\r\n} from 'vuex'\r\n\r\nimport openSetting from '@/df-components/openSetting/openSetting';\r\nimport { url2temPath } from '@/tools/tools';\r\nimport { bindMobileTips } from '@/tools/const.js';\r\n\r\nexport default {\r\n\tcomponents: { openSetting },\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tisShowOpenSetting: false,\r\n\t\t\tisShowLoading: true,\r\n\t\t\t// 头像信息\r\n\t\t\tavatarSrc: '', //头像地址\r\n\t\t\tavatarSize: 0, //头像尺寸\r\n\r\n\t\t\t// 二维码信息\r\n\t\t\tcodeSize: 0, //二维码尺寸\r\n\t\t\tcodeX: 0, //二维码x坐标\r\n\t\t\tcodeY: 0, //二维码y坐标\r\n\r\n\t\t\t// 画布信息\r\n\t\t\tcanvasBgWidth: 0, //画布宽\r\n\t\t\tcanvasBgHeight: 0, //画布高\r\n\r\n\t\t\t// 背景图信息\r\n\t\t\tgbImgSrc: '',\r\n\r\n\t\t\t//存放临时路径的对象\r\n\t\t\ttemPathArr: {\r\n\t\t\t\tavatar: '', //头像\r\n\t\t\t\tcode: '', //初始二维码\r\n\t\t\t\tbg: '', //背景图片\r\n\t\t\t\tavatarCode: '' //头像二维码 (剪切圆形的头像本地地址)\r\n\t\t\t},\r\n\t\t\tshareImgPath: ''\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tlet that = this;\r\n\t\t// #ifdef H5\r\n\t\tuni.showModal({\r\n\t\t\tshowCancel: false, //不显示取消按钮\r\n\t\t\ttitle: '请使用小程序或app生成分销海报',\r\n\t\t\tsuccess(e) {\r\n\t\t\t\t//确认后的回调\r\n\t\t\t\tconsole.log(e);\r\n\t\t\t\tthat.toBackFn()\r\n\t\t\t}\r\n\t\t});\r\n\t\tthat.isShowLoading = false;\r\n\t\t// #endif\r\n\t},\r\n\tonShow() {\r\n\t\tlet that = this;\r\n\t\tthat.isShowLoading = true;\r\n\t\t// #ifdef APP-PLUS || MP-WEIXIN\r\n\t\t// 收银系统功能- 未绑定手机号不能操作以下功能\r\n\t\tif(!that.isRunBindMobileFunc){\r\n\t\t\tthat.isShowLoading = false;\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: bindMobileTips,\r\n\t\t\t\tsuccess(e) {\r\n\t\t\t\t\te.confirm && that.navigateToFn({url: `/packageA/tel-login/user-info`});\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthat.setConfigFn();\r\n\t\t// #endif\r\n\t},\r\n\tonLoad() {\r\n\t\tconsole.log('vuex 的 头像地址that.userInfoAvatar;', this.userInfoAvatar);\r\n\t},\r\n\tmethods: {\r\n\t\t// pc后台转换单位函数\r\n\t\tpc2pxFn(px) {\r\n\t\t\tpx = px - 0;\r\n\t\t\t// pc后台设置屏幕宽度320\r\n\t\t\treturn (this.windowWidth * px) / 320;\r\n\t\t},\r\n\r\n\t\t// 把配置列表的信息复制到data里\r\n\t\tasync setConfigFn() {\r\n\t\t\tlet that = this;\r\n\t\t\tthat.avatarSrc = that.userInfoAvatar; //头像地址\r\n\t\t\tthat.gbImgSrc = that.configInfo.invite_bg_img; //背景图地址\r\n\r\n\t\t\tif (!that.gbImgSrc) {\r\n\t\t\t\tthat.failFn({\r\n\t\t\t\t\tmsg: '未设置海报背景图片'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthat.codeX = that.pc2pxFn(that.configInfo.invite_bg_qrcode_left); //二维码左边距\r\n\t\t\tthat.codeY = that.pc2pxFn(that.configInfo.invite_bg_qrcode_top); //二维码上边距\r\n\t\t\tthat.codeSize = that.pc2pxFn(that.configInfo.invite_bg_qrcode_size); //二维码大小\r\n\r\n\t\t\tthat.canvasBgWidth = that.windowWidth; //画布宽\r\n\t\t\tthat.canvasBgHeight = that.pc2pxFn(540); //画布高\r\n\r\n\t\t\tthat.avatarSize = (that.codeSize * 192) / 430;\r\n\r\n\t\t\t// 获取分享二维码图片链接\r\n\t\t\tlet shareCodeImgHttpSrc = await that.getShareCodeImgFn();\r\n\r\n\t\t\tif (shareCodeImgHttpSrc.type == 'success') {\r\n\t\t\t\tPromise.all([\r\n\t\t\t\t\turl2temPath(shareCodeImgHttpSrc.result),\r\n\t\t\t\t\turl2temPath(that.avatarSrc),\r\n\t\t\t\t\turl2temPath(that.gbImgSrc)\r\n\t\t\t\t])\r\n\t\t\t\t\t.then(temPathArr => {\r\n\t\t\t\t\t\t//初始二维码    //头像    //背景图片\r\n\t\t\t\t\t\tthat.temPathArr.code = temPathArr[0].result;\r\n\t\t\t\t\t\tthat.temPathArr.avatar = temPathArr[1].result;\r\n\t\t\t\t\t\tthat.temPathArr.bg = temPathArr[2].result;\r\n\r\n\t\t\t\t\t\tconsole.log(that.temPathArr, '拿到三个临时路径', '\\n');\r\n\r\n\t\t\t\t\t\tthat.clipArcAvatarFn();\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(e => {\r\n\t\t\t\t\t\tthat.failFn({\r\n\t\t\t\t\t\t\tmsg: e.msg\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthat.failFn({\r\n\t\t\t\t\tmsg: shareCodeImgHttpSrc.msg\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(that.avatarSrc, ' 头像地址', '\\n', that.gbImgSrc, ' 背景地址', '\\n');\r\n\t\t},\r\n\t\t// 剪切头像 成圆形\r\n\t\tasync clipArcAvatarFn() {\r\n\t\t\tlet that = this;\r\n\t\t\t// 创建画布对象\r\n\t\t\tlet ctx = uni.createCanvasContext('avatarCanvas');\r\n\r\n\t\t\t// 根据 图片的大小 绘制底图 的大小\r\n\t\t\tlet imgW = that.avatarSize,\r\n\t\t\t\timgH = that.avatarSize,\r\n\t\t\t\timgPath = that.temPathArr.avatar;\r\n\r\n\t\t\tctx.save();\r\n\t\t\tctx.arc(imgW / 2, imgH / 2, imgW / 2, 0, 2 * Math.PI); //绘制圆形\r\n\t\t\tctx.setStrokeStyle('rgba(0,0,0,0)');\r\n\t\t\tctx.stroke(); //这个一定要有，不然图片不剪切，我就是遇到了这个问题\r\n\t\t\tctx.clip(); //剪切\r\n\t\t\tctx.drawImage(imgPath, 0, 0, imgW, imgH); //置入图片\r\n\t\t\tctx.restore(); //恢复之前保存的绘图上下文\r\n\t\t\tctx.draw(true, () => {\r\n\t\t\t\t//保存画布上的东西 画完后执行回调\r\n\t\t\t\tthat.saveAvatarFn();\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 保存圆形头像地址\r\n\t\tsaveAvatarFn() {\r\n\t\t\tlet that = this;\r\n\t\t\t// 拿到拼合好的图片\r\n\t\t\tuni.canvasToTempFilePath(\r\n\t\t\t\t{\r\n\t\t\t\t\tcanvasId: 'avatarCanvas',\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tlet tempFilePath = res.tempFilePath;\r\n\r\n\t\t\t\t\t\tthat.temPathArr.avatarCode = tempFilePath;\r\n\r\n\t\t\t\t\t\tconsole.log('保存完圆形头像的临时路径开始 画最终分享图', '\\n');\r\n\t\t\t\t\t\tthat.createSharImgFn();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\tthat.failFn({\r\n\t\t\t\t\t\t\tmsg: '获取圆形头像路径失败'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tthat\r\n\t\t\t);\r\n\t\t},\r\n\t\t// 生成分享图片\r\n\t\tasync createSharImgFn() {\r\n\t\t\tlet that = this;\r\n\t\t\tlet bgImgSrc = that.temPathArr.bg;\r\n\r\n\t\t\t// 创建画布对象\r\n\t\t\tlet ctx = uni.createCanvasContext('sharImgCanvas');\r\n\t\t\t// 获取图片信息，要按照原图来绘制，否则图片会变形\r\n\r\n\t\t\t// 根据 图片的大小 绘制底图 的大小\r\n\t\t\tlet imgW = that.canvasBgWidth,\r\n\t\t\t\timgH = that.canvasBgHeight,\r\n\t\t\t\timgPath = bgImgSrc;\r\n\r\n\t\t\t// 绘制底图 用原图的宽高比绘制\r\n\t\t\tctx.drawImage(imgPath, 0, 0, imgW, imgH);\r\n\t\t\t(() => {\r\n\t\t\t\t// 根据 图片的大小 绘制底图 的大小\r\n\t\t\t\tlet imgW = that.codeSize,\r\n\t\t\t\t\timgH = that.codeSize,\r\n\t\t\t\t\timgPath = that.temPathArr.code;\r\n\r\n\t\t\t\tctx.drawImage(imgPath, that.codeX, that.codeY, imgW, imgH);\r\n\r\n\t\t\t\tctx.beginPath();\r\n\r\n\t\t\t\tlet { avatarSize, avatarX, avatarY } = that.getAvatarInfo();\r\n\r\n\t\t\t\tctx.arc(avatarX, avatarY, avatarSize / 2, 0, 2 * Math.PI);\r\n\t\t\t\tctx.setFillStyle('#ffffff');\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\tctx.drawImage(\r\n\t\t\t\t\tthat.temPathArr.avatarCode,\r\n\t\t\t\t\tavatarX - avatarSize / 2,\r\n\t\t\t\t\tavatarY - avatarSize / 2,\r\n\t\t\t\t\tavatarSize,\r\n\t\t\t\t\tavatarSize\r\n\t\t\t\t);\r\n\r\n\t\t\t\tctx.draw(true, () => {\r\n\t\t\t\t\tthat.showShareImgFn();\r\n\t\t\t\t});\r\n\t\t\t})();\r\n\t\t},\r\n\r\n\t\t// 获取头像尺寸坐标信息\r\n\t\tgetAvatarInfo() {\r\n\t\t\tlet that = this;\r\n\t\t\tlet avatarSize = parseInt((that.codeSize * 192) / 430), //头像尺寸\r\n\t\t\t\tavatarMargin = (that.codeSize - avatarSize) / 2, //头像距离二维码图片边框的边界距离\r\n\t\t\t\tavatarX = avatarMargin + that.codeX + avatarSize / 2, //头像在整个画布上的距离X\r\n\t\t\t\tavatarY = avatarMargin + that.codeY + avatarSize / 2; //头像在整个画布上的距离Y\r\n\t\t\treturn {\r\n\t\t\t\tavatarSize,\r\n\t\t\t\tavatarX,\r\n\t\t\t\tavatarY\r\n\t\t\t};\r\n\t\t},\r\n\r\n\t\t// 获取分享二维码链接\r\n\t\tgetShareCodeImgFn() {\r\n\t\t\tlet that = this;\r\n\t\t\treturn new Promise(async (resFn, rejFn) => {\r\n\t\t\t\tlet result = await that.$request({\r\n\t\t\t\t\turl: '/api/Share/xcxImg'\r\n\t\t\t\t});\r\n\t\t\t\tif (result.statusCode == 200) {\r\n\t\t\t\t\tif (result.data.code == 200) {\r\n\t\t\t\t\t\tresFn({\r\n\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\tmsg: '获取分享二维码图片成功',\r\n\t\t\t\t\t\t\tresult: result.data.data\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trejFn({\r\n\t\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\t\tmsg: result.data.msg,\r\n\t\t\t\t\t\t\tresult: result.data.msg\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\trejFn({\r\n\t\t\t\t\t\ttype: 'error',\r\n\t\t\t\t\t\tmsg: that.$errorMsg,\r\n\t\t\t\t\t\tresult: that.$errorMsg\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tfailFn(failMsg) {\r\n\t\t\tlet that = this;\r\n\t\t\tuni.showModal({\r\n\t\t\t\tshowCancel: false, //不显示取消按钮\r\n\t\t\t\ttitle: failMsg.msg,\r\n\t\t\t\tsuccess(e) {\r\n\t\t\t\t\t//确认后的回调\r\n\t\t\t\t\tconsole.log(e);\r\n\t\t\t\t\tthat.toBackFn();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 点击保存到本地\r\n\t\tsaveShearImgFn() {\r\n\t\t\tlet that = this;\r\n\t\t\t// 未绑定手机号不能操作以下功能\r\n\t\t\tif(!that.isRunBindMobileFunc){\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: bindMobileTips,\r\n\t\t\t\t\tsuccess(e) {\r\n\t\t\t\t\t\te.confirm && that.navigateToFn({url: `/packageA/tel-login/user-info`});\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\tthat.saveImgFn(that.shareImgPath);\r\n\t\t\t// #endif\r\n\r\n\t\t\t// #ifdef APP-PLUS\r\n\t\t\tthat.saveImgAppFn(that.shareImgPath);\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\t// 安卓app端保存图片\r\n\t\tsaveImgAppFn(src) {\r\n\t\t\t\r\n\t\t\tuni.getImageInfo({\r\n\t\t\t\tsrc,\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\t\tfilePath: res.path,\r\n\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\t\ttitle: '保存成功'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail() {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\ttitle: '保存失败'\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tfail(e) {\r\n\t\t\t\t\tconsole.log('获取图片信息错误', e);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 保存图片函数\r\n\t\tasync saveImgFn(src) {\r\n\t\t\tlet that = this;\r\n\t\t\t// 获取权限列表的信息\r\n\t\t\tlet settingInfo = await that.settingInfoFn('scope.writePhotosAlbum');\r\n\t\t\tconsole.log(settingInfo, '获取权限列表的信息', '\\n');\r\n\r\n\t\t\tif (settingInfo.type == 'success') {\r\n\t\t\t\t// 如果用户 授权 了 并且 授权 状态是 禁止的 状态\r\n\t\t\t\tif (settingInfo.isOk == false && settingInfo.isFirst == false) {\r\n\t\t\t\t\t// 打开权限列表 让用户打开该状态\r\n\t\t\t\t\t// that.openSettingFn('scope.writePhotosAlbum');\r\n\r\n\t\t\t\t\tthat.isShowOpenSetting = true;\r\n\t\t\t\t\t/*\r\n\r\n\r\n\t\t\t\t\twx.openSetting({\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tconsole.log(res.authSetting);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t */\r\n\t\t\t\t}\r\n\t\t\t\t// 如果是第一次使用该 权限 或者 该权限已通过 正常调用函数\r\n\t\t\t\tif (settingInfo.isFirst || settingInfo.isOk) {\r\n\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\tsrc: src,\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\t\t\t\tfilePath: res.path,\r\n\t\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\t\t\t\ttitle: '保存成功'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail() {\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\t\t\ttitle: '保存失败'\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(e) {\r\n\t\t\t\t\t\t\tconsole.log('获取图片信息错误', e);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\ttitle: settingInfo.msg\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tcloneSettingFn() {\r\n\t\t\tconsole.log('cloneSettingFn', '\\n');\r\n\t\t\tthis.isShowOpenSetting = false;\r\n\t\t},\r\n\t\t// canvas画完后 展示最后的分享图片\r\n\t\tshowShareImgFn() {\r\n\t\t\tlet that = this;\r\n\t\t\t// 拿到拼合好的图片\r\n\t\t\tuni.canvasToTempFilePath(\r\n\t\t\t\t{\r\n\t\t\t\t\tcanvasId: 'sharImgCanvas',\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tlet tempFilePath = res.tempFilePath;\r\n\t\t\t\t\t\tthat.shareImgPath = tempFilePath;\r\n\t\t\t\t\t\tthat.isShowLoading = false;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\tthat.failFn({\r\n\t\t\t\t\t\t\tmsg: '保存失败稍后重试'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tthat\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\t...mapState({\r\n\t\t\tuserInfoAvatar: store => store.userInfo.userInfoAvatar, // 头像地址\r\n\t\t})\r\n\t}\r\n\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page,\r\npage {\r\n\tbackground: $bg-grey-color;\r\n\tmin-height: 100vh;\r\n\twidth: 100%;\r\n\tdisplay: inline-block;\r\n}\r\n\r\n.bottom-btn-block {\r\n\tmargin: 20px 0;\r\n\t@include flex-center;\r\n\twidth: 100%;\r\n\theight: 100rpx;\r\n\t.pay-btn {\r\n\t\t@include btn-green;\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./canvas.vue?vue&type=style&index=0&id=ec52d74e&lang=scss&scoped=true&\"; export default mod; export * from \"-!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!E:\\\\HBuilderX.2.6.9.20200403\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./canvas.vue?vue&type=style&index=0&id=ec52d74e&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1675502581594\n      var cssReload = require(\"E:/HBuilderX.2.6.9.20200403/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}